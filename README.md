# Идея проекта
Этот проект возник из желания попрактиковаться в ETL процессе на локальной домашней станции.  
Мне хотелось иметь возможность настраивать процесс под свои нужды и столкнуться с тонкостями развертывания непосредственно.
## Задачи проекта
1. Развернуть в docker'е Airflow и MySQL
2. Создать DAG для обработки данных, используя датасет "NYC Yellow Taxi" за май 2023.  
   В DAG должны быть включены 3 задачи: extract data, transform data и load data.

## О docker-compose файле
Используя официальный .yaml для развертывания airflow, я дополнил его лишь одним сервисом - MySQL версии 8.0
Распределние RAM:
- Airflow - 4 GB  
- Postgres (используется под Airflow) - 1 GB  
- MySQL - 1 GB
  
Запустить его можно, используя команду ``` docker-compose up ``` в терминале, находясь в директории проекта  

## Credentials 
### Airflow 
- localhost:8080
- login - airflow
- password - airflow
### MySQL
- server - localhost
- port - 3306
- database - db
- login - admin
- password - admin
- root password - adminroot

## Добавление connection в Airflow
В load-части DAGа, я использовал заранее сохраненный в airflow connection_id, как мне кажется это практичнее и удобнее в использовании.  
Создать connection можно в UI самого Airflow в разделе Admin-connections.  
Стоит упомянуть, что если вы используете WSL для Docker'а, то в строку "Host" вам следует вписать ваш локальный IPv4 адрес.  

## Создание таблицы в базе данных
[Скрипт](sql/create_table.sql)

## О task'ах 
### Extract-часть
Используем BashOperator для загрузки parquet файла с данными (файл загружается на worker ноду)  
### Transform-часть
1. Данные загружаются в Pandas Dataframe.
2. Выполняется запрос, который выбирает только те поездки, в которых:
    - Пассажир ехал не в одиночку.
    - Дистанция поездки больше или равна 5 милям.
    - Поездка была оплачена картой.
3. Удаляются лишние столбцы.
4. Dataframe преобразуется в список кортежей без заголовков (headers).
5. Функция возвращает список кортежей.
### Load-часть 
В данной части задачи функции передается список кортежей, полученных из Transform-части, путем указания этого в параметрах таска.  
Затем происходит подключение к базе данных с помощью MySqlHook, и все данные из списка кортежей загружаются в соответствующую таблицу в базе данных.  
